# Plugins
Series of plugins integrated into the project, plugins in development.

## Master
This is the master plugin, it is in charge of doing the analysis of the file using the native library of the project, all plugins must call the master plugin to work with the data resulting from the analysis, by default this plugin does:
- Generates a report with the data resulting from the analysis.
- Generates the dataset and integrates the data into the dataset if specified by the user.

## YaraRuler Plugin

Generate a YARA rule based on the possible IOCs in the program (must be for better accuracy e.g. inserting strings, or more data extracted).

> PATH: ./yara-rules/*.yar

```yara
// YARA Rule Example
rule AgentTesla_Rule {

      meta:
        author = "D4nex"
        date = "2025-01-23"
        description = "Yara rule generated by DeePE for AgentTesla sample"
        hash1 = "cce284cab135d9c0a2a64a7caec09107"
        hash2 = "e4b8f4b6cab18b9748f83e9fffd275ef5276199e"
        hash3 = "18aab0e981eee9e4ef8e15d4b003b14b3a1b0bfb7233fade8ee4b6a22a5abbb9"

      strings:
        $imp = "7eae418c7423834ffc3d79b4300bd6fb"
        $op1 = {55 8b ec 83 ec 5c 83 7d 0c 0f 74 2b 83 7d 0c 46 8b 45 14 75 0d 83 48 18 10 8b 0d 08 a2 42 00 89 48 04 50 ff 75 10 ff 75 0c ff 75 08 ff 15 1c 82 40 00 e9 42 01 00 00 53 56 8b 35 14 a2 42 00 8d 45 a4 57 50 ff 75 08 ff 15 20 82 40 00 83 65 f4 00 89 45 0c 8d 45 e4 50 ff 75 08 ff 15 24 82 40 00 8b 7d f0 83 65 f0 00 8b 1d 60 80 40 00 e9 80 00 00 00 0f b6 46 52 0f b6 56 56 0f af 55 e8 8b}
      condition:
          any of them
  }
```

## PEParser Plugin

PEParser is a plugin that allows to extract information in hexadecimal format from the headers(**IMAGE_DOS_HEADER**, **IMAGE_FILE_HEADER**, **IMAGE_OPTIONAL_HEADER**) of the analyzed file.

### IMAGE_DOS_HEADER
```
struct DOS_HEADER {
    uint16_t e_magic; // Magic number (must be "MZ" or 0x5A4D)
    uint16_t e_cblp; // Bytes in the last page of the file
    uint16_t e_cp; // Pages in the file
    uint16_t e_crlc; // Number of relocations
    uint16_t e_cparhdr; // Header size in paragraphs
    uint16_t e_minalloc; // Minimum number of extra paragraphs
    uint16_t e_maxalloc; // Maximum number of additional paragraphs
    uint16_t e_ss; // Initial value of the SS register (Stack segment)
    uint16_t e_sp; // Initial value of the SP register (Stack pointer)
    uint16_t e_csum; // Checksum
    uint16_t e_ip; // Initial value of the IP register (Instruction Pointer)
    uint16_t e_cs; // Initial value of the CS register (Code Segment)
    uint16_t e_lfarlc; // Offset of the relocation table
    uint16_t e_ovno; // Overlay number
    uint16_t e_res[4]; // Reserved (4 words)
    uint16_t e_oemid; // OEM identifier
    uint16_t e_oeminfo; // OEM Information
    uint16_t e_res2[10]; // Reserved (10 words)
    uint32_t e_lfanew; // Offset to PE header (New header)
};
```

### IMAGE_FILE_HEADER
```
struct FILE_HEADER {
    uint16_t Machine; // Machine architecture (e.g. x86, x64)
    uint16_t NumberOfSections; // Number of sections in the file
    uint32_t TimeDateStamp; // Compilation time stamp
    uint32_t PointerToSymbolTable; // Offset to the symbol table (deprecated in PE)
    uint32_t NumberOfSymbols; // Number of symbols in the table (deprecated in PE)
    uint16_t SizeOfOptionalHeader; // Size of optional header (PE)
    uint16_t Characteristics; // Flags describing file characteristics
};
```
## IMAGE_OPTIONAL_HEADER
```
struct OPTIONAL_HEADER {
    // Standard fields (present in all PE versions)
    uint16_t Magic; // Magic number indicating PE type (32-bit or 64-bit)
    uint8_t MajorLinkerVersion; // Major version of the linker
    uint8_t MinorLinkerVersion; // Minor version of the linker
    uint32_t SizeOfCode; // Code section size
    uint32_t SizeOfInitializedData; // Size of initialized data section
    uint32_t SizeOfUninitializedData; // Size of the uninitialized data section
    uint32_t AddressOfEntryPoint; // Entry point (RVA of the startup code)
    uint32_t BaseOfCode; // Base RVA of the code section
    uint32_t BaseOfData; // Base RVA of the data section (PE32 only)
    
    // Windows specific fields
    uint32_t ImageBase; // Preferred base address of the image in memory
    uint32_t SectionAlignment; // In-memory section alignment
    uint32_t FileAlignment; // File section alignment
    uint16_t MajorOperatingSystemVersion; // Major version of operating system required
    uint16_t MinorOperatingSystemVersion; // Minor version of the required operating system
    uint16_t MajorImageVersion; // Major image version
    uint16_t MinorImageVersion; // Minor image version
    uint16_t MajorSubsystemVersion; // Major version of the required subsystem
    uint16_t MinorSubsystemVersion; // Minor version of the required subsystem
    uint32_t Win32VersionValue; // Reserved (must be 0)
    uint32_t SizeOfImage; // Total size of the image in memory
    uint32_t SizeOfHeaders; // Size of all PE headers
    uint32_t CheckSum; // Checksum of the image
    uint16_t Subsystem; // Required subsystem (e.g. GUI, console)
    uint16_t DllCharacteristics; // DLL Characteristics
    uint32_t SizeOfStackReserve; // Size reserved for the stack
    uint32_t SizeOfStackCommit; // Initial committed size for the stack
    uint32_t SizeOfHeapReserve; // Reserved size for the heap
    uint32_t SizeOfHeapCommit; // Initial committed size for the heap
    uint32_t LoaderFlags; // Obsolete (must be 0)
    uint32_t NumberOfRvaAndSizes; // Number of entries in the data directory
    IMAGE_DATA_DIRECTORY DataDirectory[16]; // Data directories (e.g. Imports, Exports)
};
```